<h1><%= @user.name %>&#39;s Profile</h1>

<!-- follow or unfollow - start -->
<% if signed_in? && current_user.id != @user.id %>

  <% if current_user.follows?(@user) %>
    <% follow = Follow.where(follower_id: current_user.id, leader_id: @user.id)[0] %>
  <% end %>

  <% action = (current_user.follows?(@user) ? follow_url(follow) : follows_url) %>
  <% method = (current_user.follows?(@user) ? "delete" : "post") %>
  <% message = (current_user.follows?(@user) ? "Unfollow" : "Follow") %>

  <form action="<%= action %>" method="post">
    <input
      name="_method"
      type="hidden"
      value="<%= method %>">
    <input
      name="authenticity_token"
      type="hidden"
      value="<%= form_authenticity_token %>">
    <input
      id="follow_leader_id"
      name="follow[leader_id]"
      type="hidden"
      value="<%= @user.id %>">
    <input
      id="follow_follower_id"
      name="follow[follower_id]"
      type="hidden"
      value="<%= current_user.id %>">
    <input type="submit" value="<%= message %>" class="btn btn-default">
  </form>
  <br>
<% end %>
<!-- follow or unfollow - end -->


<table class="table table-striped table-bordered table-condensed user-show-table">
  <tr>
    <td><b>&#35; Submissions:</b></td>
    <td><%= @user.number_submissions %></td>
  </tr>
  <tr>
    <td><b>&#37; Successful:</b></td>
    <td><%= @user.percent_successful %></td>
  </tr>
  <tr>
    <td><b>&#35; Easy solved:</b></td>
    <td><%= @user.number_easy_submissions %></td>
  </tr>
  <tr>
    <td><b>&#35; Medium solved:</b></td>
    <td><%= @user.number_medium_submissions %></td>
  </tr>
  <tr>
    <td><b>&#35; Hard solved:</b></td>
    <td><%= @user.number_hard_submissions %></td>
  </tr>
</table>

<h3>Submissions:</h3>

<% @user.solutions.reverse.each_with_index do |solution, index| %>
  <% challenge = solution.challenge %>
  <% language = solution.language %>

  <% if language == "Ruby" %>
    <h3><%= link_to challenge.name, challenge_url(challenge) %> in Ruby</h3>
  <% else %>
    <h3><%= link_to challenge.name, js_challenge_url(challenge) %> in JavaScript</h3>
  <% end %>

  Solution: <%= solution.success ? "Successful" : "Failed"%> <br><br>

  <% if (signed_in? && current_user.have_solved?(challenge, language)) || !solution.success %>

    <div id="editor-readonly<%= index %>" class="editor-readonly"><%= solution.method_string %></div>


    <script>
      var editor = ace.edit("editor-readonly<%= index %>");
      <% if language == "Ruby" %>
        var RubyMode = require("ace/mode/ruby").Mode;
        editor.getSession().setMode(new RubyMode());
      <% else %>
        var JavaScriptMode = require("ace/mode/javascript").Mode;
        editor.getSession().setMode(new JavaScriptMode());
      <% end %>
      editor.setOptions({
        readOnly: true,
        highlightActiveLine: false,
        highlightGutterLine: false,
        maxLines: 100
      })
      editor.renderer.$cursorLayer.element.style.opacity=0
    </script>
    <br>
  
    <% if solution.success %>
      <% if language == "Ruby" %>
        <% answer = solution.challenge.ruby_answer %>
      <% else %>
        <% answer = solution.challenge.javascript_answer %>
      <% end %>

      Official Solution:<br><br>
      <div id="editor-readonly-official<%= index %>" class="editor-readonly"><%= answer %></div>


      <script>
        var editor = ace.edit("editor-readonly-official<%= index %>");
        <% if language == "Ruby" %>
          var RubyMode = require("ace/mode/ruby").Mode;
          editor.getSession().setMode(new RubyMode());
        <% else %>
          var JavaScriptMode = require("ace/mode/javascript").Mode;
          editor.getSession().setMode(new JavaScriptMode());
        <% end %>
        editor.setOptions({
          readOnly: true,
          highlightActiveLine: false,
          highlightGutterLine: false,
          maxLines: 100
        })
        editor.renderer.$cursorLayer.element.style.opacity=0
      </script>
      <br>
    <% end %>
  <% end %>

<% end %>

